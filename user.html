<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>user - Pikko Videos</title>
  <meta name="description" content="user page">
  <meta property="og:title" content="Pikko Videos">
  <meta property="og:description" content="user page">
  <meta property="og:url" content="https://videos.bird.f5.si">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="js/config.js"></script>
  <script src="js/dark.js"></script>
  <link rel="stylesheet" href="css/animation.css" type="text/css">
  <link rel="stylesheet" href="css/dark.css" type="text/css">
  <link rel="icon" href="favicon.ico">
  <style>
    .videoCard {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
    }
    .videoCard img {
      width: 320px;
      height: auto;
      display: block;
      margin-bottom: 5px;
      border-radius: 5px;
    }
    .userHeader {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }
    .userHeader img {
      width: 60px;
      height: 60px;
      margin-right: 10px;
      border-radius: 5px;
    }
  </style>
</head>
<body class="bg-animation">
  <a href="./"><img src="logo.png" alt="logo" width="200" height="100"></a>
  <p><button onclick="toggleTheme()" id="themeBtn">Light Mode</button></p>
  <p><input type="button" value="share" onclick="copyUrl()"></p>
  <select id="sortOrder" onchange="loadVideos()" style="margin-bottom: 10px;">
    <option value="new">Newest first</option>
    <option value="old">Oldest first</option>
  </select>
  <div id="content"></div>

  <script>
    const params = new URLSearchParams(location.search);
    const name = params.get("name");

    if (!name) {
      document.getElementById("content").innerText =
        "Pikko and Pikko Videos couldn't find this user.";
    } else {
      fetch(`${SERVER}/users`)
        .then(res => res.json())
        .then(data => {
          const usersArray = data.users || [];
          const usernames = usersArray.map(u => u.username);
          if (!usernames.includes(name)) {
            document.getElementById("content").innerText =
              "Pikko and Pikko Videos couldn't find this account.";
          } else {
            document.title = `${name} - Pikko Videos`;
            const iconPath = `${SERVER}/icons/${name}.jpg`;
            document.getElementById("content").innerHTML = `
              <div class="userHeader">
                <img src="${iconPath}" alt="icon">
                <h1>${name}</h1>
              </div>
              <div id="videoList">Loading...</div>`;
            loadVideos();
          }
        });
    }

    function loadVideos() {
      fetch(`${SERVER}/videos/user/${name}`)
        .then(res => res.json())
        .then(videos => {
          const sort = document.getElementById("sortOrder").value;
          videos.sort((a, b) => {
            const timeA = new Date(a.date).getTime();
            const timeB = new Date(b.date).getTime();
            return sort === "new" ? timeB - timeA : timeA - timeB;
          });

          const list = videos.map(v => `
            <div class="videoCard">
              <img src="${SERVER}/thumbnails/${v.thumbnail || `${v.id}.jpg`}" alt="thumb"><br>
              <b>${v.title}</b><br>
              ${new Date(v.date).toLocaleString("ja-JP", {
                year: "numeric",
                month: "2-digit",
                day: "2-digit",
                hour: "2-digit",
                minute: "2-digit"
              })}<br>
              <a href="watch?id=${v.id}">watch</a>
            </div>
          `).join("");

          document.getElementById("videoList").innerHTML = list || "No videos yet.";
        });
    }

    function copyUrl() {
      const url = location.href;
      navigator.clipboard.writeText(url);
    }
  </script>
</body>
</html>
