<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <script>const SERVER = "https://pikko1.tcpexposer.com";</script>
  <title>embed - Pikko Videos</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #000;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .media-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    video, audio {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      background-color: #000;
    }
    .overlay {
      position: absolute;
      top: 20px;
      right: 20px;
    }
    .thumb {
      width: 120px;
      opacity: 0.6;
    }
  </style>
</head>
<body>
  <div class="media-container" id="container">
    <!-- プレイヤーは後から挿入 -->
  </div>
  <div class="overlay">
    <a id="watch" href="#" target="_blank"><img src="logo.png" class="thumb" alt="logo"></a>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const id = params.get("id");
    const container = document.getElementById("container");

    if (!id) {
      container.innerHTML = "<p style='color:white;text-align:center;'>Video ID has not been entered.</p>";
    } else {
      fetch(`${SERVER}/videoInfo/${id}`)
        .then(res => res.ok ? res.json() : null)
        .then(info => {
          if (!info || !info.fileName) {
            container.innerHTML = "<p style='color:white;text-align:center;'>Media not found.</p>";
            return;
          }

          const ext = info.fileName.split(".").pop().toLowerCase();
          const isAudio = ext === "mp3" || ext === "wav";
          const mediaUrl = `${SERVER}/videos/${encodeURIComponent(info.fileName)}`;
          const tag = isAudio
            ? `<audio id="player" controls></audio>`
            : `<video id="player" controls muted playsinline></video>`;

          container.innerHTML = tag;
          document.getElementById("player").src = mediaUrl;
          document.getElementById("watch").href = `watch.html?id=${encodeURIComponent(id)}`;
        })
        .catch(() => {
          container.innerHTML = "<p style='color:white;text-align:center;'>Error loading content.</p>";
        });
    }
  </script>
</body>
</html>
