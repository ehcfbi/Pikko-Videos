<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>embed - Pikko Videos</title>
  <script>const SERVER = "https://pikko1.tcpexposer.com";</script>
  <script src="https://unpkg.com/wavesurfer.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #000;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .media-container {
      width: 100vw;
      height: 100vh;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    video {
      max-width: 100%;
      max-height: 100%;
      background: #000;
    }
    #waveform {
      width: 90%;
      height: 80px;
      background: #111;
      margin-bottom: 10px;
    }
    #controls {
      margin-top: 10px;
    }
    .overlay {
      position: absolute;
      top: 20px;
      right: 20px;
    }
    .thumb {
      width: 120px;
      opacity: 0.6;
    }
    button {
      background: #0af;
      color: white;
      border: none;
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 4px;
    }
    button:hover {
      background: #09c;
    }
  </style>
</head>
<body>
  <div class="media-container" id="container">
    <!-- wave/video inserted here -->
  </div>
  <div class="overlay">
    <a id="watch" href="#" target="_blank"><img src="logo.png" class="thumb" alt="logo"></a>
  </div>

  <script>
    const params = new URLSearchParams(location.search);
    const id = params.get("id");
    const container = document.getElementById("container");

    if (!id) {
      container.innerHTML = "<p style='color:white;text-align:center;'>Video ID has not been entered.</p>";
    } else {
      fetch(`${SERVER}/videoInfo/${id}`)
        .then(res => res.ok ? res.json() : null)
        .then(info => {
          if (!info || !info.fileName) {
            container.innerHTML = "<p style='color:white;text-align:center;'>Media not found.</p>";
            return;
          }

          const ext = info.fileName.split(".").pop().toLowerCase();
          const isAudio = ext === "mp3" || ext === "wav";
          const mediaUrl = `${SERVER}/videos/${encodeURIComponent(info.fileName)}`;
          document.getElementById("watch").href = `watch.html?id=${encodeURIComponent(id)}`;

          if (isAudio) {
            // 🎧 Audio player with waveform and button
            const waveformDiv = document.createElement("div");
            waveformDiv.id = "waveform";

            const btn = document.createElement("button");
            btn.id = "togglePlay";
            btn.textContent = "▶";

            const controls = document.createElement("div");
            controls.id = "controls";
            controls.appendChild(btn);

            container.appendChild(waveformDiv);
            container.appendChild(controls);

            const wavesurfer = WaveSurfer.create({
              container: '#waveform',
              waveColor: '#555',
              progressColor: '#0af',
              height: 80,
              barWidth: 2,
              responsive: true
            });

            wavesurfer.load(mediaUrl);

            btn.addEventListener("click", () => {
              wavesurfer.playPause();
            });

            wavesurfer.on("play", () => {
              btn.textContent = "⏸";
            });

            wavesurfer.on("pause", () => {
              btn.textContent = "▶";
            });

          } else {
            // 🎥 Video playback
            const video = document.createElement("video");
            video.controls = true;
            video.autoplay = true;
            video.playsInline = true;
            video.muted = true;
            video.src = mediaUrl;
            container.appendChild(video);
          }
        })
        .catch(() => {
          container.innerHTML = "<p style='color:white;text-align:center;'>Failed to load media.</p>";
        });
    }
  </script>
</body>
</html>
